<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Редактор «Танковая миссия»</title>

<style>
*{box-sizing:border-box}
html,body{
  margin:0;height:100%;
  background:#0a1020;
  color:#e6f1ff;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial
}
.app{
  position:fixed;inset:0;
  display:grid;
  grid-template-columns:420px 1fr;
  gap:12px;
  padding:12px;
}
.panel{
  background:rgba(14,22,40,.85);
  border:1px solid rgba(255,255,255,.1);
  border-radius:18px;
  padding:12px;
  overflow:auto;
}
.preview{
  background:#0b1220;
  border:1px solid rgba(255,255,255,.1);
  border-radius:18px;
  overflow:hidden;
  position:relative;
}
h3{margin:0 0 12px 0}
.section{
  margin-bottom:12px;
  padding:10px;
  border-radius:14px;
  background:rgba(255,255,255,.05);
  border:1px solid rgba(255,255,255,.08);
}
label{
  display:block;
  font-size:12px;
  color:#9bb7d6;
  margin:8px 0 6px
}
input,select,textarea,button{
  width:100%;
  padding:9px 10px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(0,0,0,.25);
  color:#e6f1ff;
}
textarea{
  font-family:monospace;
  font-size:12px;
  resize:vertical;
}
.row{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}
button{
  cursor:pointer;
  background:#1f3b6b;
  font-weight:700;
}
button.secondary{
  background:rgba(255,255,255,.08);
}
.buttons{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
iframe{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  border:0;
}
.note{
  font-size:12px;
  opacity:.75;
  margin-top:6px;
}
</style>
</head>

<body>
<div class="app">

<!-- ЛЕВАЯ ПАНЕЛЬ -->
<div class="panel">
  <h3>Редактор «Танковая миссия»</h3>

  <div class="section">
    <label>Количество ящиков (1–15)</label>
    <input id="boxCount" type="number" min="1" max="15" value="7">

    <div class="row">
      <div>
        <label>Размер танка (0.5–5)</label>
        <input id="tankScale" type="number" step="0.1" min="0.5" max="5" value="1">
      </div>
      <div>
        <label>Размер ящика (0.5–5)</label>
        <input id="boxScale" type="number" step="0.1" min="0.5" max="5" value="1">
      </div>
    </div>
  </div>

  <div class="section">
    <label>Танк (URL)</label>
    <input id="tankUrl" type="text">

    <label>Ящик (URL)</label>
    <input id="boxUrl" type="text">

    <label>Фон поля (URL)</label>
    <input id="fieldUrl" type="text">
  </div>

  <div class="section">
    <label>Звук выстрела (URL)</label>
    <input id="shootSoundUrl" type="text">

    <label>Звук попадания / взрыва (URL)</label>
    <input id="hitSoundUrl" type="text">
  </div>

  <div class="section">
    <div class="buttons">
      <button id="btnPreview">Обновить предпросмотр</button>
      <button id="btnCopy">Скопировать код</button>
    </div>

    <label style="margin-top:10px">iframe для Genially</label>
    <textarea id="iframeOutput" rows="4" readonly></textarea>

    <div class="note">
      Если Genially блокирует автокопирование — код уже выделен, нажми Ctrl+C
    </div>
  </div>
</div>

<!-- ПРАВАЯ ПАНЕЛЬ -->
<div class="preview">
  <iframe id="preview"></iframe>
</div>

</div>

<script>
const preview = document.getElementById("preview");
preview.src = "../game/index.html";

function getConfig(){
  return {
    boxCount: Number(boxCount.value),
    tankScale: Number(tankScale.value),
    boxScale: Number(boxScale.value),
    tankUrl: tankUrl.value,
    boxUrl: boxUrl.value,
    fieldUrl: fieldUrl.value,
    shootSoundUrl: shootSoundUrl.value,
    hitSoundUrl: hitSoundUrl.value
  };
}

btnPreview.onclick = () => {
  preview.contentWindow.postMessage(
    { type:"TANK_MISSION_CONFIG", payload:getConfig() },
    "*"
  );
};

btnCopy.onclick = async () => {
  const cfg = encodeURIComponent(JSON.stringify(getConfig()));
  const src =
    "https://naasi090574.github.io/tank-mission-2026/game/index.html?config=" + cfg;

  const iframe =
    `<iframe style="border:0;width:100%;height:100%;" src="${src}"></iframe>`;

  iframeOutput.value = iframe;
  iframeOutput.focus();
  iframeOutput.select();

  try{
    await navigator.clipboard.writeText(iframe);
    btnCopy.textContent = "Скопировано ✓";
  }catch(e){
    btnCopy.textContent = "Выделено — Ctrl+C";
  }

  setTimeout(()=>btnCopy.textContent="Скопировать код",2000);
};

preview.onload = btnPreview.onclick;
</script>
</body>
</html>
